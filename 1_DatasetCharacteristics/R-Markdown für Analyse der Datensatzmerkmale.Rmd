---
title: "R-Markdown für Analyse der Datensatzmerkmale - Aufgabe Dateset Characterisristics"
author: "Gruppe 2 - Alina und Lea"
date: "2024-01-21"
output: html_document
---

```{r setup, include=FALSE}
##Analyse unseres Datensatzes (grafische Darstellung, Diagramme und Informationstabellen um Hauptmerkmale des Datensatzes zusammenzufassen)

##Informationen über: Datensatzübersicht, Fehlende Werte, Feature-Verteilungen, Korrelationen
```

## R Markdown
```{r}
# Erstellen einer Liste mit benötigten Bibliotheken
pkgs <- c("readr", "dplyr", "lubridate", "ggplot2","DataExplorer")

# Laden der Bibliotheken und prüfen, ob sie installiert sind und gegebendenfalls installieren
for (pkg in pkgs) {
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg)
    library(pkg, character.only = TRUE)
  }
}
```

```{r}
#Daten laden und warengruppen extrahieren
umsatzdaten <- read.csv("0_DataPreparation/preparedTrainData.csv")
warengruppen_train <- unique(umsatzdaten$Warengruppe)
umsatzdaten$Datum <- as.Date(umsatzdaten$Datum)

```

```{r}
#Korrelastion
#cor(umsatzdaten)
##Dataexplorer zur Datenanalyse
#create_report(umsatzdaten)
#plot_correlation(umsatzdaten)
```

```{r}
# Umsatz pro Tag für alle Warengruppen
gesamtumsatz_pro_tag <- umsatzdaten %>%
  group_by(wochentag) %>%
  summarise(Gesamtumsatz = sum(Umsatz),
            n=n(), 
            mean=mean(Umsatz),
            sd=sd(Umsatz)) %>%
  mutate( se=sd/sqrt(n)) %>%
  mutate( ic=se * qt((1-0.05)/2 + .5, n-1))

balkendiagramm_train <- ggplot(gesamtumsatz_pro_tag, aes(x = wochentag, y = mean)) +
  geom_bar(stat = "identity", position = "dodge", fill="#800080")+
  geom_errorbar( aes(x=wochentag, ymin=mean-ic, ymax=mean+ic), width=0.4, colour="orange", alpha=0.9, linewidth=1.5)+
  labs(title = "Gesamtumsatz pro Tag für alle Warengruppen mit Konfidenzintervallen der Trainingsdaten", x = "Wochentag", y = "Gesamtumsatz")

print(balkendiagramm_train)

```

```{r}
my_Warengruppe <- umsatzdaten %>%
 group_by(Warengruppe, jahreszeit) %>%
 summarise(
 n=n(),
 mean_Umsatz=mean(Umsatz),
 sd_Umsatz=sd(Umsatz)
 )%>%
 mutate( se=sd_Umsatz/sqrt(n)) %>%
 mutate( ic=se * qt((1-0.05)/2 + .5, n-1)) 


head(my_Warengruppe, 200)

#Konfidenzintervall
ggplot(my_Warengruppe) + facet_wrap(~Warengruppe) +
 geom_bar( aes(x=jahreszeit, y=mean_Umsatz), stat="identity", fill="#800080", alpha=0.5) +
 geom_errorbar( aes(x=jahreszeit, ymin=mean_Umsatz-ic, ymax=mean_Umsatz+ic), width=0.3, colour="orange", alpha=0.3, size=1.5) +
 ggtitle("Konfidenzintervall") + theme(axis.text.x = element_text(angle = 90, hjust = 1))
```


```{r}
#Umsatz pro Tag je Warengruppe Trainingsdaten
gesamtumsatz_pro_tag_warengruppe <- umsatzdaten %>%
  group_by(Warengruppe, wochentag) %>%
  summarize(Gesamtumsatz = sum(Umsatz))

print(gesamtumsatz_pro_tag_warengruppe)

balkendiagramm <- ggplot(gesamtumsatz_pro_tag_warengruppe, aes(x = Warengruppe, y = Gesamtumsatz, fill = wochentag)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Gesamtumsatz pro Tag und Warengruppe der Trainingsdaten", x = "Warengruppe", y = "Gesamtumsatz", fill="Wochentag") +
  scale_fill_brewer(palette = "Set3")


# Diagramme anzeigen
print(balkendiagramm)


```

